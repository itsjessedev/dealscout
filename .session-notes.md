# DealScout Session Notes

## Project Paths
- **Backend:** `/home/jesse/portfolio/dealscout/backend/`
- **Mobile:** `/home/jesse/portfolio/dealscout/mobile/`
- **Web:** `/home/jesse/portfolio/dealscout/web/`
- **API URL:** `https://dealscout.junipr.io/api`
- **VPS Deploy:** `rsync to junipr-vps:/home/deploy/dealscout/`

---

### Session: 2025-12-24 (Christmas Eve)

**Context:** Extensive eBay sandbox integration testing and fixes.

**Accomplishments:**

**VPS Fixes:**
- Fixed 502 error - added missing `ebay_sandbox_dev_id` to config.py
- Fixed OAuth URL generation to use `get_ebay_ru_name()` getter for sandbox mode

**eBay API URL Fixes:**
- Fixed sandbox Account API URL: `apiz.sandbox.ebay.com` → `api.sandbox.ebay.com`

**OAuth Scope Additions:**
- Added `sell.account` scope (for business policy management)
- Added `sell.fulfillment` scope (for full order access)

**Listing Creation - Full Implementation:**
- Auto-creates inventory location (Cookeville, TN)
- Auto-opts in to Business Policies via API
- Auto-creates default shipping/payment/return policies
- Added brand, model, and aspects support for item specifics
- Successfully created test listing: `110588613647`

**Sandbox Test Accounts (Working):**
- Seller: `TESTUSER_DEALSCOUTSELL` / `Sellerpas$3`
- Buyer: `TESTUSER_DEALSCOUTBUYER` / `Buyerpas$3`

**Test Results:**
- ✅ OAuth flow working
- ✅ Business policy opt-in working
- ✅ Listing creation working
- ✅ Order sync API working (sandbox orders delayed)
- ✅ Test purchase completed

**Commits Made:**
- `cb28b49`: Fix eBay sandbox integration and add full listing support

**Next Session TODO:**
- [ ] Switch back to production mode when ready
- [ ] Test with real listing on production
- [ ] Verify auto-sold detection with actual sale

---

### Session: 2025-12-23 (continued #4 - evening)

**Context:** Continued web app improvements and eBay sandbox setup for testing auto-sold feature.

**Accomplishments:**

**Web App UI Fixes:**
- Fixed CSS clipping on Needs Review cards (border and title truncation)
- Moved page titles to Layout header (dynamic based on route)
- Removed duplicate "DealScout" header from main content area
- Removed unnecessary Refresh button from Current Flips (auto-syncs on load)
- Fixed Sold button stretching across container

**eBay Sandbox Support (Backend):**
- Added `EBAY_SANDBOX` config option to switch between production/sandbox APIs
- Added separate sandbox credential vars: `EBAY_SANDBOX_APP_ID`, `EBAY_SANDBOX_CERT_ID`, `EBAY_SANDBOX_RU_NAME`
- Added getter methods that auto-select credentials based on sandbox mode
- Updated all eBay services to use dynamic URLs based on sandbox setting
- Centralized URL management in `ebay_seller.py` `get_ebay_base_urls()`

**VPS Configuration:**
- Added sandbox credentials to VPS .env
- Added sandbox RuName: `Jesse_Eldridge-JesseEld-DealSc-dtecid`

**eBay Sandbox Test Accounts Created:**
- Seller: `TESTUSER_DSSELLER7829` / `$ellerpassS3` (old, replaced)
- Buyer: `TESTUSER_DSBUYER2309` / `Buyerpas$3` (old, replaced)

**Commits Made:**
- `3f41acd`: Fix CSS clipping on Needs Review cards
- `1682e3a`: Move page titles to Layout header, remove duplicate elements
- `d05e971`: Add eBay sandbox support for testing
- `a7fdd5c`: Add separate sandbox credentials config

**Status:** Completed - sandbox accounts replaced in next session

---

### Session: 2025-12-23 (continued #3)

**Context:** User asked to add toast notifications and deploy to VPS.

**Accomplishments:**
- Built **Toast notification system** (`web/src/components/Toast.tsx`)
  - ToastProvider context for app-wide notifications
  - useToast hook for showToast, showDealNotification, showSaleNotification
  - Multiple toast types: success, error, warning, info, deal, sale
  - Slide in/out animations with progress bar
  - Special gradient styling for deal/sale notifications
  - Pulse effect for important notifications

- **Integrated toast notifications** into all pages:
  - CurrentFlips.tsx: Sale notifications on eBay sync, clipboard copy, delete
  - Settings.tsx: Save success/error, eBay link/unlink/refresh
  - ListItem.tsx: Validation warnings, listing success/failure

- **Deployed web app to VPS**
  - rsync dist to junipr-vps:/home/deploy/dealscout/web/
  - Created symlink /srv/dealscout/web -> /home/deploy/dealscout/web
  - Reloaded Caddy (config was already set up)

- **Tested all API endpoints**
  - https://dealscout.junipr.io/ - Web app (200 OK)
  - https://dealscout.junipr.io/api/deals - Returns deals
  - https://dealscout.junipr.io/api/flips - Returns inventory
  - https://dealscout.junipr.io/api/settings - Returns settings
  - https://dealscout.junipr.io/api/stats - Returns profit stats

**Commits Made:**
- `de2a143`: Add toast notification system and deploy web app

**Web App URL:** https://dealscout.junipr.io

**Still TODO:**
- [ ] Add auth flow (web login)
- [ ] Add real-time deal notifications (polling or WebSocket)

---

### Session: 2025-12-23 (continued #2)

**Context:** User asked to run parallel agents to cover as much ground as possible getting web app caught up to mobile app.

**Accomplishments:**
- Built **Current Flips page** (`web/src/pages/CurrentFlips.tsx`)
  - Summary bar with total inventory value
  - Flip cards with thumbnails, status badges
  - eBay and Facebook listing buttons
  - Sell modal with price and platform selection
  - Delete functionality
  - Auto-sync eBay orders on load

- Built **List Item page** (`web/src/pages/ListItem.tsx`)
  - eBay listing creation form
  - Photo upload with previews (up to 12)
  - AI-generated title, description, category
  - Testing checklist display
  - Price input with character counter

- Built **Profits page** (`web/src/pages/Profits.tsx`)
  - Stats summary (Total Profit, Flips, Avg Profit)
  - Filter tabs (All Time / This Month / This Week)
  - Sold flips list with profit breakdown

- Built **Settings page** (`web/src/pages/Settings.tsx`)
  - Profit threshold configuration
  - eBay account linking/unlinking
  - Fee summary display
  - Save settings functionality

- Built **Layout component** (`web/src/components/Layout.tsx`)
  - Sidebar navigation (Deals, Current Flips, Profits, Settings)
  - Collapsible sidebar on desktop
  - Mobile-responsive with hamburger menu
  - Active route highlighting

- Updated **App.tsx** with all routes
- Added "Open Web App" link on Home page
- Fixed TypeScript type import errors

**All CSS files created with matching dark theme:**
- Background: #0f0f1a
- Cards: #1a1a2e
- Accent: #4ecca3
- Repair/Warning: #ff9800

**Build Status:** ✅ Passing

**Still TODO:**
- [ ] Add auth flow (web login)
- [ ] Deploy to VPS and test
- [ ] Test all API interactions with live backend

**Notes:**
- Web app now matches ~90% of mobile app functionality
- Only missing: push notifications (not applicable to web)
- All pages responsive and styled consistently

---

### Session: 2025-12-23 (earlier)

**Context:** User asked to "get the web app caught up to the mobile app" while they make dinner.

**Accomplishments:**
- Created API service for web app (`web/src/services/api.ts`) - copied from mobile
- Built Deals page with filtering tabs (Good Deals / Needs Review / All)
- Built Deal Detail page with:
  - Price breakdown (asking, market, repair cost, profit)
  - Condition selector (new/used/repair)
  - Toggleable repair options with cost calculations
  - Purchase modal
  - Dismiss functionality
- Dark theme styling matching mobile app

**Commits Made:**
- `1eff6d3`: Web app: Add API service, Deals page, and Deal Detail page

**Notes:**
- Web app uses React Router (already set up)
- Same API service as mobile (types match backend)
- Dark theme colors: bg #0f0f1a, card #1a1a2e, accent #4ecca3, repair #ff9800
